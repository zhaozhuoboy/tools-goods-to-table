# 京东商品信息同步到飞书表格 - 浏览器插件 PRD

## 1. 产品概述

### 1.1 产品定位
一款浏览器插件，用于在京东商品详情页快速提取商品信息，并同步到飞书多维表格，提高商品信息收集和管理的效率。

### 1.2 目标用户
- 电商运营人员
- 商品采购人员
- 数据分析师
- 需要批量收集商品信息的人员

## 2. 功能需求

### 2.1 插件配置功能

#### 2.1.1 飞书开发者凭证配置
- **App ID**：飞书应用的唯一标识
- **App Secret**：飞书应用的密钥
- **功能说明**：
  - 用户需要在插件设置页面输入飞书应用的 App ID 和 App Secret
  - 插件使用这些凭证获取 `tenant_access_token`（租户访问令牌）
  - 凭证信息需要加密存储（使用浏览器插件的存储 API）
  - 提供"测试连接"功能，验证凭证是否有效

#### 2.1.2 飞书表格配置
- **表格 URL**：飞书多维表格的完整 URL
- **功能说明**：
  - 用户输入飞书多维表格的 URL
  - 插件自动解析 URL，提取 `app_token` 和 `table_id`
  - URL 格式示例：`https://example.feishu.cn/base/{app_token}?table={table_id}`
  - 提供"验证表格"功能，检查表格是否存在且有写入权限

#### 2.1.3 配置管理
- 配置信息持久化存储（使用 `chrome.storage.local` 或 `browser.storage.local`）
- 支持修改和重置配置
- 配置页面可通过插件图标右键菜单或弹窗中的设置按钮访问

### 2.2 商品信息提取功能

#### 2.2.1 页面识别
- **触发条件**：仅在京东商品详情页（URL 匹配 `item.jd.com` 或 `item.m.jd.com`）激活
- **激活方式**：
  - 方式一：点击插件图标，在弹窗中点击"提取商品信息"按钮
  - 方式二：页面右键菜单添加"提取商品信息"选项
  - 方式三：页面加载完成后自动检测并显示浮动按钮

#### 2.2.2 信息提取字段
插件需要从京东商品详情页提取以下信息：

| 字段名称 | 提取位置 | 说明 |
|---------|---------|------|
| 一级类目 | 商品分类导航栏 | 如：手机 > 手机通讯 > 手机 |
| 店铺名称 | 店铺信息区域 | 如："XX官方旗舰店" |
| 商品名称 | 商品标题 | 完整的商品标题 |
| 划线价格/原价 | 价格区域 | 商品的原价（被划线的价格） |
| 当前价格 | 价格区域 | 商品的当前售价（可选） |
| 页面链接 | 当前页面 URL | 完整的商品详情页 URL |
| 商品图片 | 主图区域 | 商品主图 URL（可选） |
| 商品SKU | URL参数或页面数据 | 商品SKU编号（可选） |

#### 2.2.3 提取技术方案
- 使用 DOM 选择器定位页面元素
- 支持京东 PC 端和移动端页面
- 处理动态加载内容（使用 MutationObserver 监听 DOM 变化）
- 提取失败时提供手动输入选项

### 2.3 表单展示与编辑功能

#### 2.3.1 表单界面
- **展示方式**：插件弹窗（Popup）或内容脚本注入的浮动面板
- **表单字段**：
  - 一级类目（文本输入框）
  - 店铺名称（文本输入框）
  - 商品名称（文本输入框）
  - 划线价格/原价（数字输入框，单位：元）
  - 当前价格（数字输入框，单位：元，可选）
  - 页面链接（文本输入框，只读或可编辑）
  - 商品图片（图片预览，可选）
  - 商品SKU（文本输入框，可选）

#### 2.3.2 交互功能
- 所有字段支持用户手动编辑
- 提供"重新提取"按钮，重新从页面提取信息
- 表单验证：必填字段校验、价格格式校验
- 提供"清空表单"功能

### 2.4 数据同步功能

#### 2.4.1 写入飞书表格
- **触发方式**：点击"同步到飞书表格"按钮
- **执行流程**：
  1. 验证配置是否完整（App ID、App Secret、表格 URL）
  2. 获取 `tenant_access_token`（如果已缓存且未过期则使用缓存，否则重新获取）
  3. 解析表格 URL，获取 `app_token` 和 `table_id`
  4. 构建数据记录（JSON 格式）
  5. 调用飞书开放平台 API 写入数据
  6. 显示同步结果（成功/失败提示）

#### 2.4.2 飞书 API 调用
- **API 端点**：`https://open.feishu.cn/open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records`
- **请求方法**：POST
- **认证方式**：Bearer Token（使用 `tenant_access_token`）
- **请求头**：
  ```
  Authorization: Bearer {tenant_access_token}
  Content-Type: application/json
  ```
- **请求体格式**：
  ```json
  {
    "records": [
      {
        "fields": {
          "一级类目": "手机",
          "店铺名称": "XX官方旗舰店",
          "商品名称": "iPhone 15 Pro Max",
          "划线价格": 9999,
          "当前价格": 8999,
          "页面链接": "https://item.jd.com/123456.html",
          "商品图片": "https://img.example.com/image.jpg",
          "商品SKU": "123456789"
        }
      }
    ]
  }
  ```

#### 2.4.3 错误处理
- 网络错误：提示用户检查网络连接
- 认证失败：提示用户检查 App ID 和 App Secret
- 权限不足：提示用户检查应用权限
- 表格不存在：提示用户检查表格 URL
- 字段不匹配：提示用户检查表格字段名称
- 所有错误信息需要用户友好的中文提示

### 2.5 用户体验优化

#### 2.5.1 界面设计
- 简洁现代的 UI 设计
- 响应式布局，适配不同屏幕尺寸
- 使用图标和颜色区分不同状态（成功/失败/加载中）

#### 2.5.2 性能优化
- 缓存 `tenant_access_token`（有效期通常为 2 小时）
- 异步处理，避免阻塞页面
- 提取信息时显示加载动画

#### 2.5.3 辅助功能
- 操作历史记录（最近同步的商品）
- 批量同步功能（可选，未来版本）
- 数据导出功能（可选，未来版本）

## 3. 技术方案

### 3.1 技术栈
- **插件框架**：Chrome Extension（Manifest V3）或 WebExtension（兼容 Firefox）
- **前端技术**：HTML、CSS、JavaScript（ES6+）
- **API 调用**：Fetch API
- **存储方案**：`chrome.storage.local` 或 `browser.storage.local`

### 3.2 项目结构
```
goods-to-table/
├── manifest.json          # 插件配置文件
├── popup.html             # 插件弹窗页面
├── popup.js               # 弹窗逻辑
├── popup.css              # 弹窗样式
├── content.js             # 内容脚本（注入到页面）
├── background.js          # 后台脚本（Service Worker）
├── options.html           # 设置页面
├── options.js             # 设置页面逻辑
├── options.css            # 设置页面样式
├── icons/                 # 插件图标
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── README.md              # 项目说明文档
```

### 3.3 核心模块

#### 3.3.1 配置管理模块
- 存储和读取配置信息
- 验证配置有效性
- 加密敏感信息（可选）

#### 3.3.2 页面解析模块
- 京东页面结构分析
- DOM 元素定位和提取
- 数据清洗和格式化

#### 3.3.3 飞书 API 模块
- Token 获取和管理
- API 请求封装
- 错误处理和重试机制

#### 3.3.4 UI 模块
- 弹窗界面
- 设置页面
- 内容脚本注入的浮动面板（可选）

## 4. 飞书开发者配置说明

### 4.1 需要创建的飞书应用
1. 登录 [飞书开放平台](https://open.feishu.cn/)
2. 创建企业自建应用
3. 获取 **App ID** 和 **App Secret**

### 4.2 应用权限配置
应用需要以下权限：
- **查看、编辑和管理多维表格**：`bitable:app`
- **查看、编辑和管理多维表格中的所有数据表**：`bitable:app:readonly` 或 `bitable:app:readwrite`

### 4.3 Token 获取方式
使用以下 API 获取 `tenant_access_token`：
- **API 端点**：`https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal`
- **请求方法**：POST
- **请求体**：
  ```json
  {
    "app_id": "{app_id}",
    "app_secret": "{app_secret}"
  }
  ```
- **响应示例**：
  ```json
  {
    "code": 0,
    "msg": "success",
    "tenant_access_token": "t-xxx",
    "expire": 7200
  }
  ```

### 4.4 表格字段映射
插件提取的字段需要与飞书表格的字段名称对应。建议表格字段名称：
- 一级类目（文本类型）
- 店铺名称（文本类型）
- 商品名称（文本类型）
- 划线价格（数字类型）
- 当前价格（数字类型）
- 页面链接（超链接类型或文本类型）
- 商品图片（附件类型或文本类型，存储图片 URL）
- 商品SKU（文本类型）

## 5. 开发计划

### 5.1 第一阶段：基础功能
- [ ] 插件框架搭建
- [ ] 配置页面开发
- [ ] 飞书 API 集成
- [ ] 基础信息提取功能

### 5.2 第二阶段：核心功能
- [ ] 京东页面信息提取
- [ ] 表单界面开发
- [ ] 数据同步功能
- [ ] 错误处理

### 5.3 第三阶段：优化完善
- [ ] UI/UX 优化
- [ ] 性能优化
- [ ] 测试和 Bug 修复
- [ ] 文档编写

## 6. 注意事项

### 6.1 安全考虑
- App Secret 需要加密存储
- Token 需要安全传输（HTTPS）
- 避免在日志中输出敏感信息

### 6.2 兼容性
- 支持 Chrome、Edge、Firefox 等主流浏览器
- 兼容京东 PC 端和移动端页面
- 处理页面结构变化的情况

### 6.3 用户体验
- 提供清晰的操作指引
- 错误提示要具体明确
- 支持快捷键操作（可选）

## 7. 未来扩展功能（可选）

- 支持其他电商平台（淘宝、天猫、拼多多等）
- 批量提取和同步
- 数据统计和分析
- 定时同步功能
- 数据导出（Excel、CSV）
- 商品价格监控和提醒

---

## 确认事项

请确认以下内容：
1. 功能需求是否符合预期？
2. 飞书开发者配置方案是否可行？
3. 提取的字段是否完整？
4. 是否需要调整或补充其他功能？

